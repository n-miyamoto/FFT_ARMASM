	.arch armv5te
	.eabi_attribute 28, 1
	.fpu vfpv3-d16
	.eabi_attribute 20, 1
	.eabi_attribute 21, 1
	.eabi_attribute 23, 3
	.eabi_attribute 24, 1
	.eabi_attribute 25, 1
	.eabi_attribute 26, 2
	.eabi_attribute 30, 2
	.eabi_attribute 34, 1
	.eabi_attribute 18, 4
	.file	"fft_arm9e.c"
	.text
	.align	2
	.global	fft_16_arm9e
	@.syntax unified
	@.thumb
	@.thumb_func

y	.req	r0
c	.req	r0
x	.req	r1	
N	.req	r2
S	.req	r2
R	.req	r3
x0_r	.req	r4
x0_i	.req	r5
x1_r	.req	r6
x1_i	.req	r7
x2_r	.req	r8
x2_i	.req	r9
x3_r	.req	r10
x3_i	.req	r11
y3_r	.req	r11
y3_i	.req	r10
t0	.req	r12
t1	.req	r14

.macro	c_ldr0	a,	offset
	ldrsh	x0_i,	[\a, #2]
	ldrsh	x0_r,	[\a],	\offset
.endm
.macro	c_ldr1	a,	offset
	ldrsh	x1_i,	[\a, #2]
	ldrsh	x1_r,	[\a],	\offset
.endm
.macro	c_ldr2	a,	offset
	ldrsh	x2_i,	[\a, #2]
	ldrsh	x2_r,	[\a],	\offset
.endm
.macro	c_ldr3	a,	offset
	ldrsh	x3_i,	[\a, #2]
	ldrsh	x3_r,	[\a],	\offset
.endm
.macro 	c_strx0	a,	offset
	strh  	x0_i,	[\a, #2]
	strh  	x0_r,	[\a],	 \offset
.endm
.macro 	c_strx1	a,	offset
	strh  	x1_i,	[\a, #2]
	strh  	x1_r,	[\a],	 \offset
.endm
.macro 	c_strx2	a,	offset
	strh  	x2_i,	[\a, #2]
	strh  	x2_r,	[\a],	 \offset
.endm
.macro 	c_stry3	a,	offset
	strh  	y3_i,	[\a, #2]
	strh  	y3_r,	[\a],	 \offset
.endm

.macro 	c_fft4	s, one=1, two=2
	@ (x2,x3) = (x2+x3, x2-x3)
	add	x2_r,	x2_r,	x3_r
	add	x2_i,	x2_i,	x3_i
	sub	x3_r,	x2_r,	x3_r,	LSL#1
	sub	x3_i,	x2_i,	x3_i,	LSL#1
	@ (x0,x1) = (x0+(x1 >> s), x0-(x1 >> s))/4
	mov	x0_r,	x0_r,	ASR#2
	mov	x0_i,	x0_i,	ASR#2
	add	x0_r,	x0_r,	x1_r,	ASR#\s+\two
	add	x0_i,	x0_i,	x1_i,	ASR#\s+\two
	sub	x1_r,	x0_r,	x1_r,	ASR#\s+\one
	sub	x1_i,	x0_i,	x1_i,	ASR#\s+\one
	@ (x0,x2) = (x0 + (x2>>s)/4, x0-(x2>>s)/4)
	add	x0_r,	x0_r,	x2_r,	ASR#\s+\two
	add	x0_i,	x0_i,	x2_i,	ASR#\s+\two
	sub	x2_r,	x0_r,	x2_r,	ASR#\s+\one
	sub	x2_i,	x0_i,	x2_i,	ASR#\s+\one
	@ (x1,y3) = (x1 -i* (x3>>s)/4, x1i+i*(xs32>>s)/4)
	add	x1_r,	x1_r,	x3_i,	ASR#\s+\two
	sub	x1_i,	x1_i,	x3_r,	ASR#\s+\two
	sub	y3_r,	x1_r,	x3_i,	ASR#\s+\one
	add	y3_i,	x1_i,	x3_r,	ASR#\s+\one
.endm
.macro c_mul9e	ar, ai, x, w
	smulbt	t0,	\x,	\w
	smulbb	\ar,	\x,	\w
	smultb	\ai,	\x,	\w
	smlatt	\ar,	\x,	\w,	\ar
	sub	\ai,	\ai,	t0
.endm

	@void fft_16_arm9e(short *y, short *x, unsigned int N)
fft_16_arm9e:
	@ args = 0, pretend = 0, frame = 0
	@ frame_needed = 0, uses_anonymous_args = 0
	@ link register save eliminated.
	stmfd	sp!,	{r4-r11, lr}
	mov	t0,	#0
	mvn	R,	#0x80000000
	@first stage load and bit reverse
first_stage_arm9e:
	adds	t1,	x,	t0,	LSL#2 
	c_ldr0	t1,	N
	c_ldr2	t1,	N
	c_ldr1	t1,	N
	c_ldr3	t1,	N
	c_fft4	0
	c_strx0	y,	#4 
	c_strx1	y,	#4 
	c_strx2	y,	#4 
	c_stry3	y,	#4 
	@bitreverse
	rsc	t0,	t0,	N,	LSR #2
	clz	t1,	t0
	eors	t0,	t0,	R,	ASR t1
	bne	first_stage_arm9e
	@finish first stage
	sub	x,	y,	N,	LSL #2
	mov	R,	#16
	movs	S,	N,	LSR#4
	ldmeqfd	sp!,	{r4-r11,pc}
	adr	c,	fft_table_arm9e
next_stage_arm9e:
	stmfd	sp!,	{x, S}
	add	t0,	R,	R,	LSL#1
	add	x,	x,	t0
	sub	S,	S,	#1 << 16
next_block_arm9e:
	add	S,	S,	R,	LSL#(16-2)
next_butterfly_arm9e:
	ldr	x2_r,	[x],	-R
	ldr	x2_i,	[c],	#4
	ldr	x1_r,	[x],	-R
	ldr	x1_i,	[c],	#4
	ldr	x0_r,	[x],	-R
	ldr	x0_i,	[c],	#4
	c_mul9e	x3_r,	x3_i,	x2_r,	x2_i	
	c_mul9e	x2_r,	x2_i,	x1_r,	x1_i	
	c_mul9e	x1_r,	x1_i,	x0_r,	x0_i	
	c_ldr0	x,	#0
	c_fft4	15
	c_strx0	x,	R
	c_strx1	x,	R
	c_strx2	x,	R
	c_stry3	x,	#4
	subs	S,	S,	#1<<16
	bge	next_butterfly_arm9e
	add	t0,	R,	R,	LSL#1
	add	x,	x,	t0
	sub	S,	S,	#1
	movs	t1,	S,	LSL#16
	subne	c,	c,	t0
	bne	next_block_arm9e
	ldmfd	sp!,	{x,S}
	mov	R,	R,	LSL#2
	movs	S,	S,	LSR#2
	bne	next_stage_arm9e
	ldmfd	sp!,	{r4-r11,pc}

fft_table_arm9e:
	@N=16
	.hword  0x7fff,0x0000,	0x7fff,0x0000,	0x7fff,0x0000
	.hword 	0x30fc,0x7642,	0x7642,0x30fc,	0x5a82,0x5a82
	.hword 	0xa57e,0x5a82,	0x5a82,0x5a82,	0x0000,0x7fff
	.hword 	0x89be,0xcf04,	0x30fc,0x7642,	0xa57e,0x5a82
	@N=64
	.hword	0x7fff,0x0000,	0x7fff,0x0000,	0x7fff,0x0000
	.hword	0x7a7d,0x2528,	0x7f62,0x0c8c,	0x7d8a,0x18f9
	.hword	0x6a6e,0x471d,	0x7d8a,0x18f9,	0x7642,0x30fc
	.hword	0x5134,0x62f2,	0x7a7d,0x2528,	0x6a6e,0x471d
	.hword	0x30fc,0x7642,	0x7642,0x30fc,	0x5a82,0x5a82
	.hword	0x0c8c,0x7f62,	0x70e3,0x3c57,	0x471d,0x6a6e
	.hword	0xe707,0x7d8a,	0x6a6e,0x471d,	0x30fc,0x7642
	.hword	0xc3a9,0x70e3,	0x62f2,0x5134,	0x18f9,0x7d8a
	.hword	0xa57e,0x5a82,	0x5a82,0x5a82,	0x0000,0x7fff
	.hword	0x8f1d,0x3c57,	0x5134,0x62f2,	0xe707,0x7d8a
	.hword	0x8276,0x18f9,	0x471d,0x6a6e,	0xcf04,0x7642
	.hword	0x809e,0xf374,	0x3c57,0x70e3,	0xb8e3,0x6a6e
	.hword	0x89be,0xcf04,	0x30fc,0x7642,	0xa57e,0x5a82
	.hword	0x9d0e,0xaecc,	0x2528,0x7a7d,	0x9592,0x471d
	.hword	0xb8e3,0x9592,	0x18f9,0x7d8a,	0x89be,0x30fc
	.hword 	0xdad8,0x8583,	0x0c8c,0x7f62,	0x8276,0x18f9
	@N=256
	.hword  0x7FFF,0x0000,  0x7FFF,0x0000,  0x7FFF,0x0000
	.hword  0x7FA7,0x096A,  0x7FF6,0x0324,  0x7FD8,0x0647
	.hword  0x7E9D,0x12C8,  0x7FD8,0x0647,  0x7F62,0x0C8B
	.hword  0x7CE3,0x1C0B,  0x7FA7,0x096A,  0x7E9D,0x12C8
	.hword  0x7A7D,0x2528,  0x7F62,0x0C8B,  0x7D8A,0x18F8
	.hword  0x776C,0x2E11,  0x7F09,0x0FAB,  0x7C29,0x1F19
	.hword  0x73B5,0x36BA,  0x7E9D,0x12C8,  0x7A7D,0x2528
	.hword  0x6F5F,0x3F17,  0x7E1D,0x15E2,  0x7884,0x2B1F
	.hword  0x6A6D,0x471C,  0x7D8A,0x18F8,  0x7641,0x30FB
	.hword  0x64E8,0x4EBF,  0x7CE3,0x1C0B,  0x73B5,0x36BA
	.hword  0x5ED7,0x55F5,  0x7C29,0x1F19,  0x70E2,0x3C56
	.hword  0x5842,0x5CB4,  0x7B5D,0x2223,  0x6DCA,0x41CE
	.hword  0x5133,0x62F2,  0x7A7D,0x2528,  0x6A6D,0x471C
	.hword  0x49B4,0x68A6,  0x798A,0x2826,  0x66CF,0x4C3F
	.hword  0x41CE,0x6DCA,  0x7884,0x2B1F,  0x62F2,0x5133
	.hword  0x398C,0x7255,  0x776C,0x2E11,  0x5ED7,0x55F5
	.hword  0x30FB,0x7641,  0x7641,0x30FB,  0x5A82,0x5A82
	.hword  0x2826,0x798A,  0x7504,0x33DE,  0x55F5,0x5ED7
	.hword  0x1F19,0x7C29,  0x73B5,0x36BA,  0x5133,0x62F2
	.hword  0x15E2,0x7E1D,  0x7255,0x398C,  0x4C3F,0x66CF
	.hword  0x0C8B,0x7F62,  0x70E2,0x3C56,  0x471C,0x6A6D
	.hword  0x0324,0x7FF6,  0x6F5F,0x3F17,  0x41CE,0x6DCA
	.hword  0xF9B9,0x7FD8,  0x6DCA,0x41CE,  0x3C56,0x70E2
	.hword  0xF055,0x7F09,  0x6C24,0x447A,  0x36BA,0x73B5
	.hword  0xE708,0x7D8A,  0x6A6D,0x471C,  0x30FB,0x7641
	.hword  0xDDDD,0x7B5D,  0x68A6,0x49B4,  0x2B1F,0x7884
	.hword  0xD4E1,0x7884,  0x66CF,0x4C3F,  0x2528,0x7A7D
	.hword  0xCC22,0x7504,  0x64E8,0x4EBF,  0x1F19,0x7C29
	.hword  0xC3AA,0x70E2,  0x62F2,0x5133,  0x18F8,0x7D8A
	.hword  0xBB86,0x6C24,  0x60EC,0x539B,  0x12C8,0x7E9D
	.hword  0xB3C1,0x66CF,  0x5ED7,0x55F5,  0x0C8B,0x7F62
	.hword  0xAC65,0x60EC,  0x5CB4,0x5842,  0x0647,0x7FD8
	.hword  0xA57E,0x5A82,  0x5A82,0x5A82,  0x0000,0x7FFF
	.hword  0x9F14,0x539B,  0x5842,0x5CB4,  0xF9B9,0x7FD8
	.hword  0x9931,0x4C3F,  0x55F5,0x5ED7,  0xF375,0x7F62
	.hword  0x93DC,0x447A,  0x539B,0x60EC,  0xED38,0x7E9D
	.hword  0x8F1E,0x3C56,  0x5133,0x62F2,  0xE708,0x7D8A
	.hword  0x8AFC,0x33DE,  0x4EBF,0x64E8,  0xE0E7,0x7C29
	.hword  0x877C,0x2B1F,  0x4C3F,0x66CF,  0xDAD8,0x7A7D
	.hword  0x84A3,0x2223,  0x49B4,0x68A6,  0xD4E1,0x7884
	.hword  0x8276,0x18F8,  0x471C,0x6A6D,  0xCF05,0x7641
	.hword  0x80F7,0x0FAB,  0x447A,0x6C24,  0xC946,0x73B5
	.hword  0x8028,0x0647,  0x41CE,0x6DCA,  0xC3AA,0x70E2
	.hword  0x800A,0xFCDC,  0x3F17,0x6F5F,  0xBE32,0x6DCA
	.hword  0x809E,0xF375,  0x3C56,0x70E2,  0xB8E4,0x6A6D
	.hword  0x81E3,0xEA1E,  0x398C,0x7255,  0xB3C1,0x66CF
	.hword  0x83D7,0xE0E7,  0x36BA,0x73B5,  0xAECD,0x62F2
	.hword  0x8676,0xD7DA,  0x33DE,0x7504,  0xAA0B,0x5ED7
	.hword  0x89BF,0xCF05,  0x30FB,0x7641,  0xA57E,0x5A82
	.hword  0x8DAB,0xC674,  0x2E11,0x776C,  0xA129,0x55F5
	.hword  0x9236,0xBE32,  0x2B1F,0x7884,  0x9D0E,0x5133
	.hword  0x975A,0xB64C,  0x2826,0x798A,  0x9931,0x4C3F
	.hword  0x9D0E,0xAECD,  0x2528,0x7A7D,  0x9593,0x471C
	.hword  0xA34C,0xA7BE,  0x2223,0x7B5D,  0x9236,0x41CE
	.hword  0xAA0B,0xA129,  0x1F19,0x7C29,  0x8F1E,0x3C56
	.hword  0xB141,0x9B18,  0x1C0B,0x7CE3,  0x8C4B,0x36BA
	.hword  0xB8E4,0x9593,  0x18F8,0x7D8A,  0x89BF,0x30FB
	.hword  0xC0E9,0x90A1,  0x15E2,0x7E1D,  0x877C,0x2B1F
	.hword  0xC946,0x8C4B,  0x12C8,0x7E9D,  0x8583,0x2528
	.hword  0xD1EF,0x8894,  0x0FAB,0x7F09,  0x83D7,0x1F19
	.hword  0xDAD8,0x8583,  0x0C8B,0x7F62,  0x8276,0x18F8
	.hword  0xE3F5,0x831D,  0x096A,0x7FA7,  0x8163,0x12C8
	.hword  0xED38,0x8163,  0x0647,0x7FD8,  0x809E,0x0C8B
	.hword  0xF696,0x8059,  0x0324,0x7FF6,  0x8028,0x0647

	.size	fft_16_arm9e, .-fft_16_arm9e
	.ident	"GCC: (Ubuntu/Linaro 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609"
	.section	.note.GNU-stack,"",%progbits

